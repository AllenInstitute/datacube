<!DOCTYPE html>
<html>
   <head>
      <title>Datacube</title>

      <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <script src="https://autobahn.s3.amazonaws.com/autobahnjs/latest/autobahn.min.jgz"></script>

      <script type="text/javascript">

         var sess = null;

         $(document).ready(function()
         {
            // the URL of the WAMP Router (e.g. Crossbar.io)
            //
            var wsuri;
            if (document.location.origin == "file://") {
               wsuri = "ws://localhost:8080/ws";
            } else {
               wsuri = "ws://" + document.location.hostname + ":8080/ws";
            }
            
            // connect to WAMP server
            //
            var connection = new autobahn.Connection({
               url: wsuri,
               realm: 'realm1'
            });

            connection.onopen = function (session) {
               console.log("connected to " + wsuri);
               sess = session;
            };

            connection.onclose = function (reason, details) {
               console.log("connection gone", reason, details);
               sess = null;
            }

            connection.open();
         });


         function load_data() {
            var args = null;
            var proc= "org.alleninstitute.datacube.load";

            sess.call("org.alleninstitute.datacube.load", args).then(
               function (res) {
                  $('#heatmapdisplay').html(res);
               },
               function (err) {
                  alert("Error (" + err.reason + ")");
               }
            );

         }
     </script>
   </head>
   <body>
      <h1>Datacube Cell Types Heatmap</h1>
      <noscript>
         <span style="color: #f00; font-weight: bold;">
            You need to turn on JavaScript.
         </span>
      </noscript>
      <table id="heatmap">
         <tr>
            <td id="heatmapdisplay" colspan="1">heatmap</td>
         </tr>
         <tr><td style="height: 0.5em;" colspan="1"></td></tr>
         <tr>
            <td><button onclick='load_data();'>load</button></td>
         </tr>
      </table>
   </body>
 </html>
